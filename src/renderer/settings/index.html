<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';">
  <title>Claude's Party - Settings</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="settings-container">
    <header class="header">
      <h1>Settings</h1>
      <p class="subtitle">Configure Claude's Party</p>
    </header>

    <main class="settings-content">
      <!-- ElevenLabs Section -->
      <section class="settings-section">
        <h2>Voice (ElevenLabs)</h2>
        <p class="section-desc">Enable voice input and output using ElevenLabs</p>

        <div class="form-group">
          <label for="elevenlabs-api-key">API Key</label>
          <input type="password" id="elevenlabs-api-key" placeholder="Enter your ElevenLabs API key">
          <span class="hint">Get your API key from <a href="#" id="elevenlabs-link">elevenlabs.io</a></span>
        </div>

        <div class="form-group">
          <label for="elevenlabs-voice-id">Voice ID</label>
          <input type="text" id="elevenlabs-voice-id" placeholder="EXAVITQu4vr4xnSDxMaL">
          <span class="hint">Default: Rachel (EXAVITQu4vr4xnSDxMaL)</span>
        </div>

        <div class="form-row">
          <div class="toggle-group">
            <label class="toggle">
              <input type="checkbox" id="voice-input-enabled">
              <span class="toggle-slider"></span>
            </label>
            <span>Enable Voice Input</span>
          </div>

          <div class="toggle-group">
            <label class="toggle">
              <input type="checkbox" id="voice-output-enabled">
              <span class="toggle-slider"></span>
            </label>
            <span>Enable Voice Output</span>
          </div>
        </div>
      </section>

      <!-- Twilio Section -->
      <section class="settings-section">
        <h2>SMS (Twilio)</h2>
        <p class="section-desc">Receive SMS notifications and respond via text</p>

        <details class="instructions-box">
          <summary>Setup Instructions</summary>
          <div class="instructions-content">
            <ol>
              <li>Create a Twilio account at <strong>twilio.com</strong></li>
              <li>Find your Account SID and Auth Token in the Twilio Console dashboard</li>
              <li>Enter them below and click <strong>Auto Setup</strong> - this will automatically use an existing phone number or purchase one</li>
              <li>Enter your personal phone number to receive notifications</li>
              <li><strong>For replies:</strong> Use ngrok (<code>ngrok http 31549</code>) and enter the HTTPS URL as the webhook</li>
            </ol>
            <div class="reply-format">
              <strong>Reply format:</strong> Just text your message (goes to waiting session) or <code>sessionId:message</code> for a specific session
            </div>
          </div>
        </details>

        <div class="form-group">
          <label for="twilio-account-sid">Account SID</label>
          <input type="text" id="twilio-account-sid" placeholder="ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
        </div>

        <div class="form-group">
          <label for="twilio-auth-token">Auth Token</label>
          <input type="password" id="twilio-auth-token" placeholder="Enter your Twilio auth token">
        </div>

        <div class="form-group">
          <label for="twilio-phone-number">Twilio Phone Number</label>
          <div class="input-with-button">
            <input type="tel" id="twilio-phone-number" placeholder="+1234567890">
            <button id="setup-twilio-btn" class="btn btn-secondary btn-small">Auto Setup</button>
          </div>
          <span class="hint">Your Twilio phone number (with country code). Click Auto Setup to configure automatically.</span>
        </div>

        <div class="form-group">
          <label for="user-phone-number">Your Phone Number</label>
          <input type="tel" id="user-phone-number" placeholder="+1234567890">
          <span class="hint">Where to send SMS notifications</span>
        </div>

        <div class="form-group">
          <label for="twilio-webhook-url">Webhook URL (for replies)</label>
          <input type="text" id="twilio-webhook-url" placeholder="https://your-domain.com/sms">
          <span class="hint">Use ngrok or similar for local development. Leave empty to skip webhook setup.</span>
        </div>

        <div class="form-row">
          <div class="toggle-group">
            <label class="toggle">
              <input type="checkbox" id="sms-notifications-enabled">
              <span class="toggle-slider"></span>
            </label>
            <span>Enable SMS Notifications</span>
          </div>

          <div class="toggle-group">
            <label class="toggle">
              <input type="checkbox" id="sms-reply-enabled">
              <span class="toggle-slider"></span>
            </label>
            <span>Enable SMS Replies</span>
          </div>
        </div>

        <div id="twilio-status" class="status-message hidden"></div>
      </section>

      <!-- Telegram Section -->
      <section class="settings-section">
        <h2>Telegram</h2>
        <p class="section-desc">Receive notifications and control Claude via Telegram bot</p>

        <details class="instructions-box">
          <summary>Setup Instructions</summary>
          <div class="instructions-content">
            <ol>
              <li>Open Telegram and message <strong>@BotFather</strong></li>
              <li>Send <code>/newbot</code> and follow the prompts to create your bot</li>
              <li>Copy the bot token and paste it below</li>
              <li>Click <strong>Setup</strong>, then send any message to your bot</li>
              <li>The Chat ID will be auto-detected. Click <strong>Test</strong> to verify.</li>
            </ol>
            <div class="reply-format">
              <strong>Bot Commands:</strong><br>
              <code>/status</code> - Show active sessions<br>
              <code>/help</code> - Show available commands<br>
              <code>/session &lt;id&gt; &lt;message&gt;</code> - Send to specific session<br>
              Or just send a message to reply to the waiting session
            </div>
          </div>
        </details>

        <div class="form-group">
          <label for="telegram-bot-token">Bot Token</label>
          <input type="password" id="telegram-bot-token" placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz">
          <span class="hint">Create a bot with @BotFather on Telegram to get your token</span>
        </div>

        <div class="form-group">
          <label for="telegram-chat-id">Chat ID</label>
          <div class="input-with-button">
            <input type="text" id="telegram-chat-id" placeholder="Auto-detected when you message the bot">
            <button id="setup-telegram-btn" class="btn btn-secondary btn-small">Setup</button>
          </div>
          <span class="hint">Send a message to your bot and click Setup to auto-detect</span>
        </div>

        <div class="form-row">
          <div class="toggle-group">
            <label class="toggle">
              <input type="checkbox" id="telegram-notifications-enabled">
              <span class="toggle-slider"></span>
            </label>
            <span>Enable Notifications</span>
          </div>

          <div class="toggle-group">
            <label class="toggle">
              <input type="checkbox" id="telegram-reply-enabled">
              <span class="toggle-slider"></span>
            </label>
            <span>Enable Replies</span>
          </div>
        </div>

        <button id="test-telegram-btn" class="btn btn-secondary">Test Telegram</button>
        <div id="telegram-status" class="status-message hidden"></div>
      </section>

      <!-- Discord Section -->
      <section class="settings-section">
        <h2>Discord</h2>
        <p class="section-desc">Receive notifications and control Claude via Discord</p>

        <details class="instructions-box">
          <summary>Setup Instructions</summary>
          <div class="instructions-content">
            <strong>For notifications only (easy):</strong>
            <ol>
              <li>In Discord, right-click your channel → Edit Channel → Integrations → Webhooks</li>
              <li>Create a webhook, copy the URL, and paste it below</li>
            </ol>
            <strong>For replies (advanced):</strong>
            <ol>
              <li>Go to <strong>discord.com/developers/applications</strong></li>
              <li>Create a New Application → Bot → Copy the token</li>
              <li>Enable "Message Content Intent" under Privileged Gateway Intents</li>
              <li>Invite bot to your server with "Read Messages" and "Send Messages" permissions</li>
              <li>In Discord Settings → Advanced → Enable Developer Mode</li>
              <li>Right-click your channel → Copy ID</li>
            </ol>
            <div class="reply-format">
              <strong>Bot Commands:</strong><br>
              <code>!status</code> - Show active sessions<br>
              <code>!help</code> - Show available commands<br>
              <code>!claude &lt;message&gt;</code> - Send to waiting session<br>
              <code>!session &lt;id&gt; &lt;message&gt;</code> - Send to specific session
            </div>
          </div>
        </details>

        <div class="form-group">
          <label for="discord-webhook-url">Webhook URL (for notifications)</label>
          <input type="text" id="discord-webhook-url" placeholder="https://discord.com/api/webhooks/...">
          <span class="hint">Create a webhook in your Discord channel settings</span>
        </div>

        <details class="advanced-discord">
          <summary>Advanced: Bot for Replies</summary>
          <div class="form-group">
            <label for="discord-bot-token">Bot Token (optional)</label>
            <input type="password" id="discord-bot-token" placeholder="Your Discord bot token">
            <span class="hint">Required for receiving replies. Create a bot at discord.com/developers</span>
          </div>

          <div class="form-group">
            <label for="discord-channel-id">Channel ID</label>
            <input type="text" id="discord-channel-id" placeholder="Channel ID for the bot to monitor">
            <span class="hint">Enable Developer Mode in Discord, right-click channel, Copy ID</span>
          </div>
        </details>

        <div class="form-row">
          <div class="toggle-group">
            <label class="toggle">
              <input type="checkbox" id="discord-notifications-enabled">
              <span class="toggle-slider"></span>
            </label>
            <span>Enable Notifications</span>
          </div>

          <div class="toggle-group">
            <label class="toggle">
              <input type="checkbox" id="discord-reply-enabled">
              <span class="toggle-slider"></span>
            </label>
            <span>Enable Replies</span>
          </div>
        </div>

        <div class="button-row">
          <button id="setup-discord-btn" class="btn btn-secondary">Setup Discord</button>
          <button id="test-discord-btn" class="btn btn-secondary">Test Discord</button>
        </div>
        <div id="discord-status" class="status-message hidden"></div>
      </section>

      <!-- Notifications Section -->
      <section class="settings-section">
        <h2>Desktop Notifications</h2>
        <p class="section-desc">Configure when to show desktop notifications</p>

        <div class="toggle-group">
          <label class="toggle">
            <input type="checkbox" id="desktop-notifications-enabled">
            <span class="toggle-slider"></span>
          </label>
          <span>Enable Desktop Notifications</span>
        </div>

        <div class="toggle-group">
          <label class="toggle">
            <input type="checkbox" id="notify-on-session-end">
            <span class="toggle-slider"></span>
          </label>
          <span>Notify when session ends</span>
        </div>

        <div class="toggle-group">
          <label class="toggle">
            <input type="checkbox" id="notify-on-error">
            <span class="toggle-slider"></span>
          </label>
          <span>Notify on errors</span>
        </div>

        <div class="toggle-group">
          <label class="toggle">
            <input type="checkbox" id="notify-on-waiting">
            <span class="toggle-slider"></span>
          </label>
          <span>Notify when waiting for input</span>
        </div>
      </section>

      <!-- UI Section -->
      <section class="settings-section">
        <h2>Appearance</h2>
        <p class="section-desc">Customize the status popover</p>

        <div class="form-group">
          <label for="popover-position">Popover Position</label>
          <select id="popover-position">
            <option value="top-right">Top Right</option>
            <option value="top-left">Top Left</option>
            <option value="bottom-right">Bottom Right</option>
            <option value="bottom-left">Bottom Left</option>
          </select>
        </div>

        <div class="form-group">
          <label for="popover-opacity">Opacity: <span id="opacity-value">95%</span></label>
          <input type="range" id="popover-opacity" min="50" max="100" value="95">
        </div>

        <div class="toggle-group">
          <label class="toggle">
            <input type="checkbox" id="always-on-top">
            <span class="toggle-slider"></span>
          </label>
          <span>Always on Top</span>
        </div>
      </section>

      <!-- Claude Code Integration Section -->
      <section class="settings-section">
        <h2>Claude Code Integration</h2>
        <p class="section-desc">Connect Claude's Party to Claude Code</p>

        <div class="hook-status-box" id="hook-status-box">
          <div class="hook-status-indicator">
            <span class="status-dot" id="hook-status-dot"></span>
            <span id="hook-status-text">Checking hook status...</span>
          </div>
          <div class="hook-status-details" id="hook-status-details"></div>
        </div>

        <div class="hook-actions">
          <button id="install-hooks-btn" class="btn btn-primary">Install Hooks</button>
          <button id="uninstall-hooks-btn" class="btn btn-danger">Uninstall Hooks</button>
          <button id="refresh-status-btn" class="btn btn-secondary">Refresh Status</button>
        </div>

        <div class="form-group" style="margin-top: 16px;">
          <label for="hook-server-port">Hook Server Port</label>
          <input type="number" id="hook-server-port" min="1024" max="65535" value="31548">
          <span class="hint">HTTP server port for receiving hook events (requires app restart)</span>
        </div>

        <details class="manual-setup">
          <summary>Manual Setup (Advanced)</summary>
          <div class="info-box">
            <h4>Manual Configuration</h4>
            <p>If automatic installation doesn't work, add this to your Claude Code settings:</p>
            <code id="hook-config">
{
  "hooks": {
    "PreToolUse": ["curl -X POST http://127.0.0.1:31548/PreToolUse -d @-"],
    "PostToolUse": ["curl -X POST http://127.0.0.1:31548/PostToolUse -d @-"],
    "Notification": ["curl -X POST http://127.0.0.1:31548/Notification -d @-"],
    "Stop": ["curl -X POST http://127.0.0.1:31548/Stop -d @-"]
  }
}
            </code>
            <button id="copy-hook-config" class="btn btn-secondary">Copy Configuration</button>
          </div>
        </details>
      </section>
    </main>

    <footer class="footer">
      <button id="save-btn" class="btn btn-primary">Save Settings</button>
      <button id="reset-btn" class="btn btn-secondary">Reset to Defaults</button>
    </footer>
  </div>

  <div id="toast" class="toast hidden"></div>

  <script src="renderer.js"></script>
</body>
</html>
